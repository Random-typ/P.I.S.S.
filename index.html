<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Button Tracker</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #111; /* Dark background */
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                overflow: hidden;
            }

            /* The Button Styling */
            #the-button {
                width: 200px;
                height: 200px;
                border-radius: 50%; /* Makes it round */
                border: none;
                cursor: pointer;
                font-size: 1.2rem;
                font-weight: bold;
                letter-spacing: 2px;
                color: white;
                text-transform: uppercase;

                /* Fancy Gradient & Shadows */
                background: linear-gradient(145deg, #ff4b1f, #ff9068);
                box-shadow:
                    0 0 30px rgba(255, 75, 31, 0.4),
                    inset 0 0 20px rgba(255, 255, 255, 0.1);

                transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                position: relative;
                z-index: 10;
            }

            /* Hover Effect */
            #the-button:hover {
                transform: scale(1.05);
                box-shadow:
                    0 0 50px rgba(255, 75, 31, 0.6),
                    inset 0 0 20px rgba(255, 255, 255, 0.2);
            }

            /* Active (Click) Effect */
            #the-button:active {
                transform: scale(0.95);
                background: linear-gradient(145deg, #e43a15, #ff7b50);
            }

            /* Success State (triggered by JS) */
            #the-button.success {
                background: linear-gradient(145deg, #11998e, #38ef7d);
                box-shadow: 0 0 50px rgba(56, 239, 125, 0.6);
                content: "SAVED";
            }

            /* A faint background glow behind everything */
            .glow-bg {
                position: absolute;
                width: 400px;
                height: 400px;
                background: radial-gradient(
                    circle,
                    rgba(255, 75, 31, 0.1) 0%,
                    rgba(0, 0, 0, 0) 70%
                );
                border-radius: 50%;
                z-index: 0;
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <div class="glow-bg"></div>
        <button id="the-button">PISS (ON) ME</button>

        <script>
            const btn = document.getElementById("the-button");

            // Helper: Cookie Management
            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
                let expires = "expires=" + d.toUTCString();
                document.cookie =
                    name + "=" + value + ";" + expires + ";path=/";
            }

            function getCookie(name) {
                let nameEQ = name + "=";
                let ca = document.cookie.split(";");
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == " ") c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0)
                        return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            // 1. Extract ID from URL
            function getId() {
                // Try to get from URL
                const path = window.location.pathname.replace(/^\/+/, "");
                if (path.length > 0) return path;

                // If URL is empty/root, try to get from Cookie
                const storedId = getCookie("user_id");
                if (storedId) return storedId;

                return Math.random().toString(36).slice(2, 8); // Default -> random
            }

            // Initialize
            const currentId = getId();
            // Update URL UI if we loaded from cookie but URL was empty (optional)
            if (window.location.pathname === "/" && currentId !== "0") {
                history.replaceState(null, "", "/" + currentId);
            }
            // Save to cookie
            setCookie("user_id", currentId, 365);

            // 2. Handle Click
            btn.addEventListener("click", async () => {
                // Visual Feedback
                const originalText = btn.innerText;
                btn.innerText = "...";

                try {
                    // Using the /api/save logic from previous step
                    const response = await fetch(`/api/save?id=${currentId}`);

                    if (response.ok) {
                        btn.classList.add("success");
                        btn.innerText = "SAVED";
                        setTimeout(() => {
                            btn.classList.remove("success");
                            btn.innerText = originalText;
                        }, 1500);
                    } else {
                        btn.innerText = originalText;
                    }
                } catch (error) {
                    console.error(error);
                    btn.innerText = originalText;
                }
            });

            // Add a link to the stats page
            const statsLink = document.createElement("a");
            statsLink.href = "/stats";
            statsLink.innerText = "VIEW STATS";
            statsLink.style.position = "absolute";
            statsLink.style.bottom = "20px";
            statsLink.style.color = "rgba(255,255,255,0.5)";
            statsLink.style.textDecoration = "none";
            statsLink.style.fontFamily = "sans-serif";
            statsLink.style.fontSize = "0.8rem";
            document.body.appendChild(statsLink);
        </script>
    </body>
</html>
